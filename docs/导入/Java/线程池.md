## 生命周期管理
`ctl`这个AtomicInteger类型，是对线程池的运行状态和线程池中有效线程的数量进行控制的一个字段， 它同时包含两部分的信息：线程池的运行状态 (runState) 和线程池内有效线程的数量 (workerCount)，高3位保存runState，低29位保存workerCount，两个变量之间互不干扰。用一个变量去存储两个值，可避免在做相关决策时，出现不一致的情况，不必为了维护两者的一致，而占用锁资源。![[Pasted image 20230206155311.png]]
## 任务执行机制
### 任务调度
![[Pasted image 20230206160601.png|400]]
### 任务缓冲
![[Pasted image 20230206160338.png]]
### 任务申请

线程需要从任务缓存模块不断地获取任务执行，帮助线程从阻塞队列中获取任务，实现线程管理模块和任务管理模块之间的通信。这部分策略由getTask实现，流程图如下：
![[Pasted image 20230206161158.png|500]]

### 任务拒绝
任务拒绝模块是线程池的保护部分，线程池有一个最大的容量，当线程池的任务缓存队列已满，并且线程池中的线程数目达到maximumPoolSize时，就需要拒绝掉该任务，采取任务拒绝策略，保护线程池。
用户可以通过实现提供的reject接口去定制拒绝策略，也可以选择已提供的四种已有拒绝策略。
![[Pasted image 20230206162545.png]]

## Worker线程管理


[Java线程池实现原理及其在美团业务中的实践 - 美团技术团队](https://tech.meituan.com/2020/04/02/java-pooling-pratice-in-meituan.html)