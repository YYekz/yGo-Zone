### URLEncode
浏览器进行网络请求时，网址中可能出现包含非ASCII形式的内容，比如中文、空格、特殊符号等。所以需要按照某种规则将这些不安全字符编码为可以传输的字符。

### Base64
早期网络协议被设计为只能传输可见字符或ASCII符号的子集，其余符号被网络协议本身使用（比如Http header中的切分`\r\n`），所以当header中的内容要包含这俩字符就得转义一下。对于音视频、图片字节流压根就不是字符直接放到只支持可见字符的传输协议上一定会乱套。
所以Base64就是解决这种问题的一套通用编码方式，可以把任意字节流转换成A-Z、a-z，0-9、+和/ 这64个可见字符（这也是为啥叫base64），这些字符在大多数网络协议中都可以安全传输，因此如果没有特殊优化的必要，可以直接把任意数据的base64无脑传输。

#### 如何转化？
1. 8bit转6bit。将原始数据每3个字节的bit映射到4个字节的数据上，转换完后每个字节只会占用6个bit，高位的2bit永远为0。这样每次结果只对应十进制的0~63中的某个数；
2. 将第一步转换好的0~63数值按照一个映射表转换为一个ascII字符。

**这时会有一个问题，原始字符如果不是3的倍数怎么办？**
1. 对于一个字节不满的补bit0，补到一个和完整字节为止，补好的字节参与步骤2的映射ascII；
2. 对于结果不满4byte的情况，补"="这个字符，补满4byte整数倍为止。

**Base64可以保证数据被正确传输吗？**：大多数场景都可以，但也有些例外，比如HTTP里规定+和/保留，那对于+和/就需要根据HTTP 的urlencoding二次编码。

**Base64可以用来加密吗？**：其实他只是一个简单的转义编码，可以情谊的反向转换编码，所以不可以用来加密。（但也有一些场景可以当做加密。[如何用通俗易懂的语言解释 BASE64? - 知乎](https://www.zhihu.com/question/38036594/answer/2957903901)）

### ASCII

规定一共128个字符编码，包含所有的大小写字母以及数字、符号、空格，只占用一个字节后面的7位，最前面一位统一为0。
因为英语中只需要子母和符号即可，但越来越多的语言表示，我们不够啊！中文这么多文字，所以出现了1981年发布的**GB2312编码**，为了与ASCII区分，他的每个字节高位都是1，但这一套只包含了6000多个常用简体汉字以满足基本日常使用需求，但还是不支持繁体字和生僻字，所以之后又进行了扩展，也就是我们常说的**GBK编码**了，也称汉字内码扩展规范。

### Unicode

那各种各样的编码格式导致在互联网上无法相互编码呀。所以推出了囊括所有符号的编码格式：**Unicode**。
> Unicode是国际标准化组织制定的一套字符编码方案，致力于统一世界上所有语言字符的编码。Unicode为每个字符分配了一个固定的数值，称为**编码点**（Code Point），所有的编码点组成的集合称为**编码空间**（Code Space）。目前Unicode的编码空间共包含`0x10FFFF`（十进制的1114111）个编码点，被划分为17个平面，每个平面包含`0xFFFF`个字符。从1991年发布的第一个版本开始，每一年都会有新的字符被编入Unicode中，目前所定义的字符集只用了不到五分之一的编码空间。

**Unicode**：是一个很大的集合，囊括了100多万个符号，但Unicode有个问题就是因为太大，导致有些符号占用的字节数太多了需要3个、4个甚至更多字节。这个时候就出现了一个问题：计算机怎么知道当前三个字节是一个符号还是三个符号呢？如果告诉计算机三个字节表示一个符号，那简简单单的英文字母本来占位一个字节，现在需要三个，会对存储产生极大的浪费。所以Unicode也无法推广开来。那现在需要一种统一的大家可以识别的编码方式，UTF-8出现了。

### UTF-8
**UTF-8**：**首先UTF-8是互联网上使用最广的一种Unicode的实现方式**（其实还包括UTF-16两个字节或四个字节表示，UTF-32四字节表示，很少使用）。一定要注意他们的关系UTF-8只是Unicode的一种实现方式。
他的规则很简单，就两条：
1. 对于但自己的符号，字节的第一位设为0，后面7位为这个符号的Unicode码。因此对于英语来说，UTF-8和ASCII码来说是相同的。
2. 对于多字节的符号，第一个字节的前n位都设为1，第n+1位设置为0，后面字节的前两位一律设为10.剩下没有提及的二进制位全部为这个符号的Unicode码。
举个例子：
0000 0000-0000 007F | 0xxxxxxx
0000 0080-0000 07FF | 110xxxxx 10xxxxxx
0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx
0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
跟据上表，解读 UTF-8 编码非常简单。如果一个字节的第一位是`0`，则这个字节单独就是一个字符；如果第一位是`1`，则连续有多少个`1`，就表示当前字符占用多少个字节。

这个时候需要说到**大端式**还是**小端式**（顾名思义，大端指的是第一个字节在前，第二个字节在前就是小端式）
那计算机怎么知道某个文件是采用的是哪一种方式呢？
Unicode规范定义，每一个文件的最前面分别加入一个标识编码顺序的字符，叫做“**零宽度非换行空格**”，用FEFF表示，这正好是两个字节，而且FF比FE大1。如果一个文件开头两个字节是FEFF，表示大端式，如果头两个字节是FFFE，就表示采用小端式。

### 其他UTF

**UTF-32**：这是最简单的一种编码方式，定长编码。使用四字节为作为一个编码单元，也就是说每一个编码点都是4字节表示。所以对应的，他的优点就是方便取，当我们想要第n位的时候，只需要在首字符的地址上加上一个固定的偏移量即可，也就是说可以在O(1)的时间复杂度索引字符串的任意位置，也就是我们常说的**随机索引**。当然缺点也十分明显，就是每个字符要占用32bit，会造成大量的空间浪费，所以用得不多。

**UTF-16**：说UTF-16之前，先说下**UCS-2编码**。在早期的Unicode标准中，之定义了不到65535（0xFFFF，2^16）个编码点，所有字符都可以用两个字节的UTF-16编码来表示，所以那时还是一个定长编码，UCS-2 也就等同于 UTF-16。但后来发现，16位不足以囊括所有的文字，就进行了扩展，新的标准中编码空间被扩展到0x10FFFF的大小，分成17块65535，第一个版苦熬就是最初的UCS-2的65535个编码点的范围，被称作**基本多文中平面（BMP）**，余下16个板块称为**辅助平面**。所以说在今天，UTF-16可以看做是UCS-2的父集。随着标准的扩充，在如今的UTF-16中使用2个字节为一个编码单元，一个编码点需要2个或4个字节来表示。
所以当编码点在0-0xFFFF的范围内时，这两个字节中所有的bit都可以用来表示编码点；但当编码点大于0xFFFF，就必须要使用到两个**代理编码点**了，分别取前后两个字节中低位的10个bit，这样就有20bit的编码空间，最大能表示0x100000的值，再加上0xFFFF，也就是0x10FFFF，Unicode的最大编码空间。
> 为了能正确表示辅助平面中的编码点，UTF-16对编码点的前缀做了一些约束，引入了一个称为`代理编码点`（surrogate）的概念。也就是在Unicode的编码空间中划分出了一块保留区域，落在在这个区域中的编码点就是代理编码点，这块区域包含从前缀`110110`到前缀`110111`的所有编码点，也就是从`1101100000000000`到`1101111111111111`的范围，十六进制为`0xD800`到`0xDFFF`。这个区域中的编码点只能成对出现在UTF-16编码中，出现在UTF-32和UTF-8中都是非法的。

**组合字符**
有趣的来了，Unicode的复杂性不仅体现在编码方式上，在Unicode中有一些字符存在多种不同的表示方式。比如一个带有音标的符号`ǎ`，它可以直接通过编码点`0x01CE`来表示，也可以使用一个`a`（编码点为`0x0061`）和一个`̌`（编码点为`0x030C`）组合起来表示，虽然说编码看起来不一样，但是这两种写法在语义上和视觉上都是相同的。这样就引入了一个新的概念，我们称`ǎ`字符和`a`、`̌`组成的序列是**标准等价**的。到了Emoji就更复杂了，很多Emoji表情使用多个Unicode码点来表示的，而且Emoji还支持使用**零宽度连接符**，将多个Emoji字符组合成新的字符。（有些Emoji表情甚至由7个Unicode字符组合而成的复杂字符）。从这些例子可以看出，Unicode中语义上的单个字符很可能是由多个字符组合而成的，为了更好的描述这一情况，Unicode引入了一个称为**字符镞**的概念（用来表示一个语义上的字符，不论是单个字符表示还是包含多个字符序列的组合字符，都视为一个字符镞）。


## 相关文章
[字符编码笔记：ASCII，Unicode 和 UTF-8 - 阮一峰的网络日志](https://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html)
[Unicode的前世今生 - 掘金](https://juejin.cn/post/6844903543279730702)