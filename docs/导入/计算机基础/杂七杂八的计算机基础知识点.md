
- **帧率**：表示**GPU在1s中内可以渲染多少帧到buffer中**，单位是fps，这里要理解的是**帧率是一个动态的**，比如我们平时说的60fps，只是1s内最多可以渲染60帧，假如我们屏幕是静止的，则GPU此时就没有任何操作，帧率就为0.  
- **屏幕刷新率**：屏幕在**1s内去buffer中取数据的次数**，单位为HZ，常见屏幕刷新率为60HZ。和帧率不一样，屏幕刷新率是一个固定值和硬件参数有关。

### 异或
异或运算有以下三个性质。

任何数和 00 做异或运算，结果仍然是原来的数，即 ``a \oplus 0=aa⊕0=a``。
任何数和其自身做异或运算，结果是 00，即 ``a \oplus a=0a⊕a=0``。
异或运算满足交换律和结合律，即 ``a \oplus b \oplus a=b \oplus a \oplus a=b \oplus (a \oplus a)=b \oplus0=b``

1. 编码格式；
2. 加密方式；

## 函数内联：是一个常见的编译器优化。把一个实际调用的函数产生的指令，直接插入到对应的位置，来替换对应函数指令的调用。
- 优点：CPU需要执行的指令数变少了，根据地址跳转的过程不需要了，压栈和出栈的过程也不需要了。
- 缺点：其实就是用空间换时间，会将程序指令直接插入到对应调用位置，如果多处调用，则整个程序占用的空间会增大。

**MAC地址**：也叫物理地址、硬件地址，长度为48位，一般表示为：00-16-EA-AE-3C-40，它是由网络设备制造商生产时烧录在网卡的EPROM（一种闪存芯片，通常可以通过程序擦写）。其中前 24 位（00-16-EA）代表网络硬件制造商的编号，后 24 位（AE-3C-40）是该厂家自己分配的，一般表示系列号。只要不更改自己的 MAC 地址，MAC 地址在世界是唯一的。形象地说，MAC地址就如同身份证上的身份证号码，具有唯一性。

[Fetching Title#cumv](https://www.polarxiong.com/archives/%E5%A4%9A%E7%BA%A7%E9%A1%B5%E8%A1%A8%E5%A6%82%E4%BD%95%E8%8A%82%E7%BA%A6%E5%86%85%E5%AD%98.html)ch
## Cache 

### 开篇概念普及
程序运行在RAM之中，RAM就是常说的DDR，我们称之为**主存**。当我们运行一个进程时，需要先从磁盘设备中将可执行程序load到主存中，再执行。CPU执行一个变量A +1操作，需要CPU从主存读取地址A的数据到通用寄存器，通用寄存器执行+1操作，CPU再将值写回主存。
但存储器是分层次的，离CPU越近的存储器，速度越快，每字节的成本越高，同时容量也因此越小。寄存器速度最快，离CPU最近，成本最高，所以个数容量有限，其次是高速缓存（缓存也是分级，有L1，L2，L3等缓存），再次是主存（普通内存），再次是本地磁盘。
寄存器的速度最快，可以在一个时钟周期内访问，其次是高速缓存，可以在几个时钟周期内访问，普通内存可以在几十个或几百个时钟周期内访问。
#### 那CPU是如何取数据的呢？
1. CPU先从L1 cache中查询是否hit,命中则直接返回给CPU；
2. 没有命中，则去L2 cache中查询是否hit，命中则将数据返回给L1以及CPU；
3. 没有命中，则去L3 cache中查询是否hit，命中则将数据返回给L2、L1和CPU；

这种存储方式成为**inclusive cache**，某一地址的数据可能存在于多级缓存中。
与之对应的是**exclusive cache**，这种cache保证某一个地址的数据只会缓存在某一级中。

cache的大小称为**cache size**。
会将cache平均分成相等的很多块，每一个块的大小称之为**cache line**。
现在的硬件设计中，一般cache line的大小是4-128bytes。**为什么不是1呢？**


#### 直接映射缓存

### Cache组织方式
cache控制器根据地址查找判断是否命中，这里的地址是**虚拟地址**。CPU发出对某个地址的数据访问，这个地址是虚拟地址，虚拟地址经过MMU转换成物理地址，最终从这个物理地址读取数据。（Cache的硬件设计既可以采用虚拟地址也可以采用物理地址甚至可以是两者地址部分组合作为查找cache的依据）

1. 虚拟高速缓存(VIVT)
2. 物理高速缓存(PIPT)
3. 物理标记的虚拟高速缓存(VIPT)


### VIVT面临的主要问题是：歧义（flush cache），别名


> 加载的时候，是如何判断内存数据是缓存到icache中还是dcache中，是怎么区分的？

哈佛结构是一种将程序指令存储和数据存储分开的存储器结构。

数据总线和地址总线是分开的，所以地址总线取的数据就是指令。数据总线取的数据就是数据。首先，硬件上是能够区分数据load到iCache还是dCache。通俗一点说，PC寄存器存储的值是指令地址，因此以PC地址取的数据都会load到iCache。其他情况load到dCache。这是硬件层面的思考。软件层面，我们会对代码段赋予可执行权限。所以默认情况下具有执行权限的数据属于指令。所以操作系统也可以知道哪些是指令哪些是数据。

所有的数据都要走data bus， 所有的指令都要走instruct bus。这个data是数据是指令没有关系，PC指到那，那就是指令。地址指到那，那就是数据；ic可以和dc sync，也可以不sync，看硬件的设计。

### Cache Line 、多核Cache一致性
存储器是分层次的，离CPU越近的存储器，速度越快，每字节的成本越高，同时容量也因此越小。寄存器速度最快，离CPU最近，成本最高，所以个数容量有限，其次是高速缓存（缓存也是分级，有L1，L2等缓存），再次是主存（普通内存），再次是本地磁盘。
寄存器的速度最快，可以在一个时钟周期内访问，其次是高速缓存，可以在几个时钟周期内访问，普通内存可以在几十个或几百个时钟周期内访问。

Cache是为了减少CPU访问主存的次数，所以就将对应的**指令和数据附近的内存区域**一起复制到了对应CPU的Cache中，下次就不用再从主存中取一次了。

每个Cache被分成多个组，每个组分成多个行，也就是**Cache Line**，**Cache Line**是cache的基本单位，所以一次复制是按照这个CL为单位进行相关操作的。如果CL为32Byte，那么一次操作必须为32Byte到对应cache中。
> 所谓8路组相连（ 8-way set associative）的含义是指，每个组里面有8个行。
> [计算机缓存Cache、Cache Line介绍](https://zhuanlan.zhihu.com/p/37749443)

为什么要有Cache？
当下CPU的运算速度非常块，但I/O设备的读写数据速度相比之下会慢很多，所以需要将可能需要的数据缓存起来。CPU增加了缓存，用来均衡与内存的速度差异。这里指的是CPU的高速缓存，属于一个硬件，现在CPU已经发展成L1、L2、L3等好几级高速缓存，高速缓存的速度仅次于CPU的寄存器，所以当需要从内存中读取值时，假如高速缓存中有，则不再花费大量时间再去内存中读取。

#### 多核Cache一致性
当下，人们试图通过增加CPU核数以提升系统整体性能，这类系统称为**多核系统**，每个CPU有自己的私有cache，那怎么保证每个CPU的cache存储一致呢？这就是多核一致性。
当CPU0修改0x40位置，除了更新自己cache之外，还应该通知其他CPU更新cache中0x40的数据,将其他CPU 0x40地址所在的cache line更新为invalid，保证其他CPU在读取数据时不会命中自己的cache中的数据。所以有两种做法保证其他CPU读取到最新的数据。
1. 从CPU0的cache中返回0x40给其他CPU；
2. 从CPU0发出invalid信号后，将0x40的数据回写给主存，其他CPU从主存中读取最新数据。

我们需要保证多核一致性，就需要办法维护一致性。可以有2种方法维护一致性，分别是软件和硬件。软件维护一致性的方法，现在基本没有采用。因为软件维护成本太高，由于维护一致性带来的性能损失抵消一部分cache带来的性能提升。所以现在的硬件会帮我们维护多核Cache一致性，并且对软件是透明的。那硬件是如何维护缓存一致性的？

**Bus Snooping Protocol**
继续上面的例子，CPU0修改了自己cache中的数据时，硬件就会广播通知总线上的其他所有CPU，对于每个CPu来说都会有特殊的硬件监听广播，检查自己是否缓存了CPU0修改的数据。如果缓存了，那么就需要更新对应的cache line。*这种理解简单，但需要时刻监听总线的事件，不管是否缓有其他CPU存了相同的数据，都要发广播事件，加重了总线负载，增加了读写延迟*。

**MESI Protocol**
MESI是现在一种使用广泛的协议，用来维护多核Cache一致性。我们可以将MESI看做是状态机。我们将每一个cache line标记状态，并且维护状态的切换。
cache line具有4中状态，分别是Modified、Exclusive、Shared和Invalid。取其首字母简称MESI。当cache line状态是Modified或者Exclusive状态时，修改其数据不需要发送消息给其他CPU，这在一定程度上减轻了带宽压力。
多核Cache一致性由硬件保证，对软件来说是透明的。因此我们不用再考虑多核Cache一致性问题。另外，现在CPU硬件采用的一致性协议一般是MESI的变种。
> MESI 细节查看文章 -> [多核一致性](https://zhuanlan.zhihu.com/p/115114220)



## 虚拟内存和物理内存

[多级页表如何节约内存 - Penguin](https://www.polarxiong.com/archives/%E5%A4%9A%E7%BA%A7%E9%A1%B5%E8%A1%A8%E5%A6%82%E4%BD%95%E8%8A%82%E7%BA%A6%E5%86%85%E5%AD%98.html)

## 分页机制   

大多数使用虚拟存储器的系统都使用一种称为**分页**机制。虚拟地址空间划分成称为页的单位，而相应的物理地址空间也被进行划分，单位是页帧（页和页帧的大小必须相同）。在这个例子中我们有一台可以生成32位地址的机器，它的虚拟地址范围从0~0xFFFFFFFF（4G），而这台机器只有256M的物理地址，因此他可以运行4G的程序，但该程序不能一次性调入内存运行。这台机器必须有一个达到可以存放4G程序的外部存储器（例如磁盘或是FLASH），以保证程序片段在需要时可以被调用。在这个例子中，页的大小为4K，页帧大小与页相同——这点是必须保证的，因为内存和外围存储器之间的传输总是以页为单位的。对应4G的虚拟地址和256M的物理存储器，他们分别包含了1M个页和64K个页帧。 

## 怎么理解阻塞非阻塞、同步异步的区别呢？
怎样理解阻塞非阻塞与同步异步的区别？ - 萧萧的回答 - 知乎 https://www.zhihu.com/question/19732473/answer/241673170

### copy-on-write
[再谈 copy-on-write - 知乎](https://zhuanlan.zhihu.com/p/136428913)
### 相关文章
[这次答应我，一举拿下 I/O 多路复用！](https://mp.weixin.qq.com/s?__biz=MzUxODAzNDg4NQ==&mid=2247489558&idx=1&sn=7a96604032d28b8843ca89cb8c129154&chksm=f98e5cbccef9d5aa249c02489614d81ce865eacb165846df84721636cd4717d1aaa830dbec56&scene=178&cur_album_id=1408057986861416450#rd)