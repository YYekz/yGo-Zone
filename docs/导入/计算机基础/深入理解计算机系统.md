# 深入理解计算机系统

### 1.5 高速缓存至关重要

### 1.7

操作系统有两个基本功能: 

1.  防止硬件被失控的应用程序滥用; 
2.  向应用程序提供简单一致的机制来控制复杂而又通常大不相同的低级硬件设备。

操作系统通过几个基本的抽象概念（进程、虚拟内存和文件）来实现这两个功能。

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/dce07630-d8e3-430f-aacf-c82ba36a9566/Untitled.png)

- 文件是对I/O设备的抽象表示；
- 虚拟内存是对主存和磁盘I/O设备的抽象表示；
- 进程则是对处理器、主存和I/O设备的抽象表示。

### 1.7.1 进程

进程是操作系统对一个正在运行的程序的一种抽象。在一个系统上可以同时运行多个 进程，而每个进程都好像在独占地使用硬件。而并发运行，则是说一个进程的指令和另 一 个进程的指令是交错执行的。在大多数系统中，需要运行的进程数是多千可以运行它们的 CPU 个数的。传统系统在一个时刻只能执行一个程序，而先进的多核处理器同时能够执 行多个程序。无论是在单核还是多核系统中，一个 CPU 看上去都像是在并发地执行多个 进程，这是通过处理器在进程间切换来实现的。操作系统实现这种交错执行的机制称为上 下文切换。

从一个进程到另一个进程的转换是由操作系统内核 (kernel)管理的。 内核是操作系统代码常驻主存的部分。当应用程序需要操作系统的某些操作时，比如读写 文件，它就执行一条特殊的系统调用 (system call)指令，将控制权传递给内核。然后内核 执行被请求的操作并返回应用程序。注意，内核不是一个独立的进程。相反，它是系统管 理全部进程所用代码和数据结构的集合。

## 1.9 重要主题

### 1.9.2 并发和并行

我们用的术语并发 (concurrency)是一个通用的概念，指一个同时具有多个活动的系统;而术语并行 (parallelism)指的是用并发来使一个系统运行得更快。并行可以在计算机系统的多个抽象层次上运用。按照系统层次结构中由高到低的顺序重点强调三个层次。

1. **线程级并行**
2. **指令级并行**
3. **单指令、多数据并行**

**超线程**

有时称为同时多线程 (simultaneous multi-threading), 是一项允许一个 CPU 执行多个控制流的技术。它涉及 CPU 某些硬件有多个备份，比如程序计数器和寄存器文 件，而其他的硬件部分只有一份，比如执行浮点算术运算的单元。常规的处理器需要大约 20 000 个时钟周期做不同线程间的转换，而超线程的处理器可以在单个周期的基础上决定 要执行哪一个线程。这使得 CPU 能够更好地利用它的处理资源。

计算机系统是由硬件和系统软件组成的，它们共同协作以运行应用程序。计算机内部的信息被表示为一组组的位，它们依据上下文有不同的解释方式。程序被其他程序翻译成不同的形式，开始时是ASCII 文本，然后被编译器和链接器翻译成二进制可执行文件。
处理器读取并解释存放在主存里的二进制指令。因为计算机花费了大量的时间在内存、 I/0 设备和 CPU 寄存器之间复制数据，所以将系统中的存储设备划分成层次结构 CPU 寄存器在顶部，接着是多 层的硬件高速缓存存储器、 DRAM 主存和磁盘存储器。在层次模型中，位于更高层的存储设备比低层的 存储设备要更快，单位比特造价也更高。层次结构中较高层次的存储设备可以作为较低层次设备的高速缓存。通过理解和运用这种存储层次结构的知识，程序员可以优化 C 程序的性能。
操作系统内核是应用程序和硬件之间的媒介。它提供三个基本的抽象: 

1. 文件是对 I/0 设备的抽象；
2. 虚拟内存是对主存和磁盘的抽象; 
3. 进程是处理器、主存和 I/0 设备的抽象。

最后，网络提供了计算机系统之间通信的手段。从特殊系统的角度来看，网络就是一种 I/0 设备。

### 2.1 信息存储

大多数计算机使用 8 位的块，或者字节 (byte), 作为最小的可寻址的内存单位，而不是访问内存中单独的位。机器级程序将内存视为一个非常大的字节数组，称为虚拟内存。内存的每个字节都由一个唯一的数字来标识，称为它的地址。所有可能地址的集合就称为虚拟地址空间。

> 它提供了引用数据结构(包括数组)的元素的机制 。与变量类似，指针也有两个方面：值和类型 。 它的值表示某个对象的位置，而它的类型 表示那个位置上所存储对象的类型(比如整数或者浮点数) 。

### 2.1.2 字数据大小
每台计算机都有一个字长 (word size), 虚拟地址是以这样的一个字来编码的，所以字长决定的最重要的系统参数就是虚拟地址空间的最大大小。也就是说，对于一个字长为 w 位的机器而言，虚拟地址的范围为 ``0 到 2^w -1``, 程序最多访问``2^w``个字节。
 32 位字长限制虚拟地址空间为 4 千兆字节(写作 4GB), 也就是说，刚刚 超过 ``4*10^9``字节。扩展到 64 位字长使得虚拟地址空间为 16EB, 大约是``1.84* 10^19 ``字节。
 > 大多数64位机器都可以运行32位机器编译的程序，也就是向后兼容。但在编译时可以指定在32或64位机器上运行。因此我们将程序称为“32位程序”或“64位程序”时，区别是在于该程序是如何编译的，而不是其运行的机器类型。
 
 ### 2.1.3 寻址和字节顺序
在几乎所有的机器上，多字节对象都被存储为连续的字节序列，对象的地址为所使用的字节中最小的地址。（也就是地址 + 偏移量）
> 某些机器选择在内存中按照从最低 有效字节到最高有效字节的顺序存储对象 - 大端法
> 另一些机器则按照从最高有效字节到最低有效 字节的顺序存储 - 小端法

